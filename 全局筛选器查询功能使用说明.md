# å…¨å±€ç­›é€‰å™¨æŸ¥è¯¢åŠŸèƒ½ä½¿ç”¨è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

å…¨å±€ç­›é€‰å™¨æŸ¥è¯¢åŠŸèƒ½å…è®¸ç”¨æˆ·é€šè¿‡è®¾ç½®ç­›é€‰å™¨æ¡ä»¶ï¼Œä¸€é”®æŸ¥è¯¢å¹¶æ›´æ–°æ‰€æœ‰ç»‘å®šäº†å…¨å±€ç­›é€‰å™¨çš„å›¾è¡¨ã€‚å½“ç‚¹å‡»"æŸ¥è¯¢"æŒ‰é’®æ—¶ï¼Œç³»ç»Ÿä¼šï¼š

1. æ‰¾åˆ°æ‰€æœ‰ç»‘å®šäº†å…¨å±€ç­›é€‰å™¨çš„å›¾è¡¨
2. æ ¹æ®æ¯ä¸ªå›¾è¡¨çš„ç»‘å®šé…ç½®å’Œç­›é€‰å™¨å½“å‰å€¼æ„å»ºè¿‡æ»¤æ¡ä»¶
3. è°ƒç”¨å¯¹åº”æ•°æ®é›†çš„æ™ºèƒ½é¢„è§ˆæ¥å£
4. å°†è¿”å›çš„æ•°æ®æ›´æ–°åˆ°å›¾è¡¨ä¸­ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“

## å®ç°åŸç†

### 1. ç­›é€‰å™¨ç»‘å®šè¯†åˆ«
ç³»ç»Ÿé€šè¿‡æ£€æŸ¥å›¾è¡¨é…ç½®ä¸­çš„ `globalFilterBindings` å±æ€§æ¥è¯†åˆ«éœ€è¦æ›´æ–°çš„å›¾è¡¨ï¼š

```typescript
const chartsToUpdate = chartLayout.value.filter(chart => 
  chart.chartConfig.globalFilterBindings && 
  chart.chartConfig.globalFilterBindings.length > 0
)
```

### 2. è¿‡æ»¤æ¡ä»¶æ„å»º
å¯¹äºæ¯ä¸ªç»‘å®šçš„å›¾è¡¨ï¼Œç³»ç»Ÿä¼šï¼š
- éå†å›¾è¡¨çš„ `globalFilterBindings` é…ç½®
- æŸ¥æ‰¾å¯¹åº”çš„ç­›é€‰å™¨ç»„ä»¶
- è·å–ç­›é€‰å™¨çš„å½“å‰å€¼
- æ ¹æ®æ“ä½œç¬¦æ˜ å°„æ„å»ºAPIè¯·æ±‚å‚æ•°

```typescript
const filters: Array<{
  fieldName: string
  operator: string
  value: any
}> = []

for (const binding of chart.chartConfig.globalFilterBindings) {
  const filterComponent = filterItems.value.find(item => 
    item.i === binding.filterKey
  )
  
  if (filterComponent && filterComponent.chartConfig.fieldName && binding.chartField) {
    const filterValue = filterValues[binding.filterKey]
    
    if (filterValue !== null && filterValue !== undefined && filterValue !== '') {
      // æ“ä½œç¬¦æ˜ å°„å’Œå€¼å¤„ç†
      filters.push({
        fieldName: binding.chartField,
        operator: apiOperator,
        value: processedValue
      })
    }
  }
}
```

### 3. æ™ºèƒ½é¢„è§ˆæ¥å£è°ƒç”¨
ä½¿ç”¨æ„å»ºçš„è¿‡æ»¤æ¡ä»¶è°ƒç”¨æ™ºèƒ½é¢„è§ˆæ¥å£ï¼š

```typescript
const previewOptions = {
  filters: filters,
  limit: chart.chartConfig.dataLimit || 50
}

const response = await smartPreviewDataset(chart.chartConfig.datasetId, previewOptions)
```

### 4. æ•°æ®è½¬æ¢å’Œæ›´æ–°
å°†è¿”å›çš„æ•°æ®è½¬æ¢ä¸ºå›¾è¡¨æ ¼å¼å¹¶æ›´æ–°ï¼š

```typescript
const chartData = transformSmartPreviewToChartData(response.data, chart.chartConfig)
chart.chartConfig.chartData = { ...chartData, _timestamp: Date.now() }
```

## æ“ä½œç¬¦æ˜ å°„

å‰ç«¯æ“ä½œç¬¦åˆ°APIæ“ä½œç¬¦çš„æ˜ å°„å…³ç³»ï¼š

| å‰ç«¯æ“ä½œç¬¦ | APIæ“ä½œç¬¦ | è¯´æ˜ |
|-----------|----------|------|
| equals | eq | ç­‰äº |
| not_equals | ne | ä¸ç­‰äº |
| contains | like | åŒ…å«ï¼ˆè‡ªåŠ¨æ·»åŠ %é€šé…ç¬¦ï¼‰ |
| not_contains | not_like | ä¸åŒ…å« |
| greater_than | gt | å¤§äº |
| greater_than_or_equal | gte | å¤§äºç­‰äº |
| less_than | lt | å°äº |
| less_than_or_equal | lte | å°äºç­‰äº |
| is_null | is_null | ä¸ºç©º |
| is_not_null | is_not_null | ä¸ä¸ºç©º |

## æ•°æ®æ ¼å¼æ”¯æŒ

ç³»ç»Ÿæ”¯æŒå¤šç§æ™ºèƒ½é¢„è§ˆæ¥å£è¿”å›çš„æ•°æ®æ ¼å¼ï¼š

### æ ¼å¼1ï¼šå¯¹è±¡æ•°ç»„æ ¼å¼
```json
{
  "columns": ["product_name", "amount"],
  "records": [
    {"product_name": "Laptop", "amount": 999.99},
    {"product_name": "Mouse", "amount": 25.50}
  ]
}
```

### æ ¼å¼2ï¼šäºŒç»´æ•°ç»„æ ¼å¼
```json
{
  "columns": ["product_name", "amount"],
  "data": [
    ["Laptop", 999.99],
    ["Mouse", 25.50]
  ]
}
```

### æ ¼å¼3ï¼šåˆ†é¡µæ ¼å¼
```json
{
  "content": [
    {"product_name": "Laptop", "amount": 999.99}
  ],
  "totalElements": 100
}
```

## å›¾è¡¨ç±»å‹æ”¯æŒ

### æŸ±çŠ¶å›¾/æŠ˜çº¿å›¾/é¢ç§¯å›¾
- æ”¯æŒ `xAxis`/`xField` å’Œ `yAxis`/`yField` å­—æ®µæ˜ å°„
- è‡ªåŠ¨æå–åˆ†ç±»å’Œæ•°å€¼æ•°æ®
- ç”Ÿæˆæ ‡å‡†çš„EChartsé…ç½®

### é¥¼å›¾
- æ”¯æŒ `nameField` å’Œ `valueField` å­—æ®µæ˜ å°„
- è‡ªåŠ¨è®¾ç½® `type: 'pie'` ç¡®ä¿æ­£ç¡®æ¸²æŸ“
- è¿‡æ»¤æ— æ•ˆæ•°æ®ï¼ˆç©ºåç§°æˆ–é›¶å€¼ï¼‰

## é”™è¯¯å¤„ç†

ç³»ç»Ÿæä¾›å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

1. **é…ç½®éªŒè¯**ï¼šæ£€æŸ¥å›¾è¡¨æ˜¯å¦æœ‰æ•°æ®é›†IDå’Œç­›é€‰å™¨ç»‘å®š
2. **APIé”™è¯¯å¤„ç†**ï¼šæ•è·æ™ºèƒ½é¢„è§ˆæ¥å£è°ƒç”¨é”™è¯¯
3. **æ•°æ®éªŒè¯**ï¼šéªŒè¯è¿”å›æ•°æ®çš„å®Œæ•´æ€§
4. **ç”¨æˆ·åé¦ˆ**ï¼šé€šè¿‡æ¶ˆæ¯æç¤ºå‘ŠçŸ¥ç”¨æˆ·æ“ä½œç»“æœ

## æ€§èƒ½ä¼˜åŒ–

1. **å¹¶è¡Œå¤„ç†**ï¼šä½¿ç”¨ `Promise.all()` å¹¶è¡Œæ›´æ–°å¤šä¸ªå›¾è¡¨
2. **å¢é‡æ›´æ–°**ï¼šåªæ›´æ–°ç»‘å®šäº†ç­›é€‰å™¨çš„å›¾è¡¨
3. **å“åº”å¼æ›´æ–°**ï¼šé€šè¿‡ `_timestamp` å¼ºåˆ¶è§¦å‘Vueå“åº”å¼æ›´æ–°
4. **é”™è¯¯éš”ç¦»**ï¼šå•ä¸ªå›¾è¡¨æ›´æ–°å¤±è´¥ä¸å½±å“å…¶ä»–å›¾è¡¨

## ä½¿ç”¨ç¤ºä¾‹

1. **æ·»åŠ ç­›é€‰å™¨**ï¼šæ‹–æ‹½ç­›é€‰å™¨ç»„ä»¶åˆ°ç­›é€‰å™¨åŒºåŸŸ
2. **é…ç½®å›¾è¡¨ç»‘å®š**ï¼šåœ¨å›¾è¡¨å±æ€§é¢æ¿ä¸­é…ç½®å…¨å±€ç­›é€‰å™¨ç»‘å®š
3. **è®¾ç½®ç­›é€‰æ¡ä»¶**ï¼šåœ¨ç­›é€‰å™¨ä¸­è¾“å…¥æˆ–é€‰æ‹©ç­›é€‰å€¼
4. **æ‰§è¡ŒæŸ¥è¯¢**ï¼šç‚¹å‡»"æŸ¥è¯¢"æŒ‰é’®åº”ç”¨ç­›é€‰æ¡ä»¶
5. **æŸ¥çœ‹ç»“æœ**ï¼šæ‰€æœ‰ç»‘å®šçš„å›¾è¡¨å°†æ ¹æ®ç­›é€‰æ¡ä»¶é‡æ–°æ¸²æŸ“

## è°ƒè¯•ä¿¡æ¯

ç³»ç»Ÿæä¾›è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š
- ğŸ” ç­›é€‰æ¡ä»¶åº”ç”¨å¼€å§‹
- ğŸ“Š æ‰¾åˆ°çš„éœ€è¦æ›´æ–°çš„å›¾è¡¨åˆ—è¡¨
- ğŸ”„ æ¯ä¸ªå›¾è¡¨çš„æ›´æ–°è¿‡ç¨‹
- ğŸ“‹ æ„å»ºçš„è¿‡æ»¤æ¡ä»¶
- âœ… æ•°æ®è·å–æˆåŠŸä¿¡æ¯
- ğŸ¨ å›¾è¡¨æ•°æ®æ›´æ–°å®Œæˆ
- âŒ é”™è¯¯ä¿¡æ¯å’Œå¤±è´¥åŸå› 

é€šè¿‡è¿™äº›æ—¥å¿—å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜å’Œä¼˜åŒ–æ€§èƒ½ã€‚ 
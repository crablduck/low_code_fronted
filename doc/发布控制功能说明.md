# 表单发布控制功能说明

## 功能概述

在表单设计器中新增了发布/取消发布控制功能，允许用户动态控制表单是否在系统菜单中显示。

## 功能特性

### 1. 发布表单
- **触发条件**: 表单状态为"草稿"时显示"发布"按钮
- **操作效果**: 
  - 表单状态更新为"已发布"
  - 自动在指定菜单下创建对应的菜单项
  - 用户可以通过菜单访问表单页面

### 2. 取消发布表单
- **触发条件**: 表单状态为"已发布"时显示"取消发布"按钮
- **操作效果**:
  - 表单状态更新为"草稿"
  - 自动删除相关的菜单项
  - 用户无法通过菜单访问表单页面

### 3. 实时菜单更新
- 发布/取消发布操作会触发菜单更新事件
- 导航栏菜单会实时刷新，无需手动刷新页面

## 界面变化

### 操作列宽度调整
- 将操作列宽度从250px增加到300px，以容纳新增的按钮

### 按钮显示逻辑
```javascript
// 草稿状态显示发布按钮
<el-button 
  v-if="row.status === 'draft'" 
  type="success" 
  size="small" 
  @click="publishForm(row)"
>
  发布
</el-button>

// 已发布状态显示取消发布按钮
<el-button 
  v-if="row.status === 'published'" 
  type="warning" 
  size="small" 
  @click="unpublishForm(row)"
>
  取消发布
</el-button>
```

## 后端API

### 取消发布接口
```
POST /api/form-configs/:id/unpublish
```

**功能**: 取消发布指定表单
**参数**: 
- `id`: 表单配置ID

**返回**: 
```json
{
  "code": 200,
  "message": "表单取消发布成功",
  "data": {
    "formId": "3",
    "routePath": "auto_page_asd", 
    "pageTitle": "asd"
  }
}
```

## 使用流程

1. **创建表单**: 通过快速向导或手动创建表单
2. **发布表单**: 点击"发布"按钮，表单变为可访问状态
3. **管理表单**: 可随时取消发布隐藏表单，或重新发布显示表单
4. **菜单同步**: 所有操作都会自动同步到系统菜单

## 技术实现

### 前端
- 在`FormDesigner/index.vue`中添加`unpublishForm`方法
- 使用`ElMessageBox`进行操作确认
- 通过`CustomEvent`触发菜单更新

### 后端
- 在`server.js`中添加`/api/form-configs/:id/unpublish`接口
- 使用数据库事务确保数据一致性
- 同时更新表单状态和删除相关菜单项

## 注意事项

1. 取消发布会删除相关菜单项，用户将无法通过菜单访问表单
2. 重新发布会创建新的菜单项，菜单ID会发生变化
3. 所有操作都有确认提示，避免误操作
4. 菜单更新是实时的，无需刷新页面

## 测试验证

✅ 发布功能正常工作
✅ 取消发布功能正常工作  
✅ 菜单项正确创建和删除
✅ 表单状态正确更新
✅ 实时菜单更新正常 
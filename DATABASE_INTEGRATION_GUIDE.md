# 数据库集成功能使用指南

## 🎯 功能概述

本系统已完成Vue3 + Element Plus表单设计器与数据库的完整集成，支持完整的低代码功能链路：

### ✅ 已实现功能

1. **数据源配置能力**
   - 支持多种数据库类型（MySQL、PostgreSQL、SQLite）
   - 数据源状态监控
   - 动态数据表列表获取

2. **表结构自动生成**
   - 从已有数据表自动生成表单字段
   - 智能字段类型映射
   - 字段属性自动配置

3. **表单设计器增强**
   - 数据源配置区域
   - 表单字段与数据库字段映射
   - 实时Schema预览

## 🚀 使用流程

### 1. 访问表单设计器
```
http://localhost:3000/form-design
```

### 2. 配置数据源
在页面顶部的"数据源配置"区域：

1. **选择目标数据库**
   - 从下拉框选择可用的数据源
   - 支持MySQL、PostgreSQL、SQLite等

2. **选择数据表（可选）**
   - 如果选择已有表，可以从表结构自动生成字段
   - 如果不选择，将根据表单名称自动生成新表

3. **配置表名称**
   - 选择已有表时，表名自动填充且不可编辑
   - 新建表时，根据表单名称自动生成或手动输入

### 3. 生成表单字段

#### 方式一：从已有表生成
1. 选择数据源和数据表
2. 点击"从表结构生成字段"按钮
3. 系统自动根据表结构生成对应的表单字段

#### 方式二：手动设计
1. 从左侧组件库拖拽组件到设计区域
2. 在右侧属性面板配置字段属性
3. 在数据配置标签页配置字段映射

### 4. 配置数据映射
在右侧属性面板的"数据配置"标签页：

1. **接口路径配置**
   - 设置表单提交的API接口地址
   - 默认：`/api/data`

2. **字段映射配置**
   - 配置表单字段与数据模型的映射关系
   - 支持实时编辑映射名称

3. **Schema预览**
   - 实时查看完整的JSON Schema
   - 包含表单结构、数据源信息、字段映射

### 5. 保存和预览
1. **保存表单**：生成完整的表单配置，包含数据源信息
2. **预览表单**：查看表单的实际渲染效果
3. **清空表单**：重置所有配置

## 📊 数据源API

### 获取数据源列表
```http
GET /api/data-sources
```

响应示例：
```json
[
  {
    "id": 1,
    "name": "MySQL主库",
    "type": "mysql",
    "host": "localhost",
    "port": 3306,
    "database": "medical_system",
    "status": "connected"
  }
]
```

### 获取数据表列表
```http
GET /api/table-list?db={dataSourceId}
```

响应示例：
```json
[
  {
    "name": "patients",
    "comment": "患者信息表",
    "columns": [...]
  }
]
```

### 获取表字段配置
```http
GET /api/table-fields/{tableName}?db={dataSourceId}
```

响应示例：
```json
[
  {
    "field": "name",
    "label": "患者姓名",
    "type": "text",
    "required": true,
    "placeholder": "请输入患者姓名"
  }
]
```

## 🔧 字段类型映射

| 数据库类型 | 表单组件类型 | 说明 |
|-----------|-------------|------|
| varchar/text | text | 文本输入框 |
| int/bigint | number | 数字输入框 |
| enum | radio/select | 单选框或下拉选择 |
| text(长文本) | textarea | 多行文本框 |
| date/datetime | date | 日期选择器 |
| boolean | radio | 是/否单选框 |

## 📝 生成的Schema格式

```json
{
  "formName": "患者登记表单",
  "dataSourceId": 1,
  "tableName": "patients",
  "fields": [
    {
      "id": "field_1640995200000",
      "type": "text",
      "field": "name",
      "label": "患者姓名",
      "placeholder": "请输入患者姓名",
      "required": true
    }
  ],
  "apiEndpoint": "/api/data",
  "fieldMapping": {
    "name": "patient_name"
  }
}
```

## 🎨 界面特性

### 数据源配置区域
- 位于页面顶部，醒目易用
- 实时显示选中的数据源状态
- 支持表结构一键生成字段

### 表单设计器
- 左侧：组件库，支持拖拽添加
- 中间：设计画布，实时预览
- 右侧：属性配置，包含字段属性和数据配置

### 验证机制
- 必须选择数据源才能保存表单
- 表单名称和字段验证
- 实时错误提示和引导

## 🔄 工作流程

1. **选择数据源** → 2. **选择/创建数据表** → 3. **生成/设计字段** → 4. **配置映射关系** → 5. **保存表单配置**

## 🌟 技术亮点

- **完整的低代码链路**：从数据源到表单设计的全流程支持
- **智能字段生成**：根据数据库表结构自动生成对应的表单字段
- **实时预览**：所见即所得的表单设计体验
- **灵活的映射配置**：支持字段名称的自定义映射
- **类型安全**：完整的TypeScript类型定义

## 🚀 快速开始

1. 启动Mock服务器：
```bash
cd mock-server && npm start
```

2. 启动前端服务：
```bash
npm run dev
```

3. 访问表单设计器：
```
http://localhost:3000/form-design
```

4. 选择数据源，开始设计表单！

---

**注意**：当前使用Mock数据进行演示，实际部署时需要连接真实的数据库服务。 